<!-- users/templates/users/login.html -->
{% extends 'base.html' %}
{% block content %}
    <h2>Login</h2>
    <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Login</button>
    </form>
<!-- login.html -->
<button onclick="loginWithGoogle()">Login with Google</button>

<script>
  async function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
      const result = await auth.signInWithPopup(provider);
      const token = await result.user.getIdToken();

      // Send token to Django backend
      const response = await fetch("/firebase-login/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ idToken: token })
      });

      if (response.ok) {
        window.location.href = "/";  // redirect to home
      } else {
        alert("Login failed");
      }
    } catch (err) {
      console.error(err);
      alert("Google sign-in error");
    }
  }
</script>

{% endblock %}

